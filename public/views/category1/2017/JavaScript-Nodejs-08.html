<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript-Nodejs-08 | Sumind&#39;s Blog</title>
    <meta name="description" content="做一个有灵魂的前端工程师">
    <link rel="icon" href="/favicon.ico">
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.75dd9f78.css" as="style"><link rel="preload" href="/assets/js/app.a9f6d8ec.js" as="script"><link rel="preload" href="/assets/js/4.f605a52d.js" as="script"><link rel="preload" href="/assets/js/1.a2510d10.js" as="script"><link rel="preload" href="/assets/js/31.cd6ba917.js" as="script"><link rel="prefetch" href="/assets/js/10.96e33a09.js"><link rel="prefetch" href="/assets/js/11.ce91667a.js"><link rel="prefetch" href="/assets/js/12.3fed3056.js"><link rel="prefetch" href="/assets/js/13.41117cae.js"><link rel="prefetch" href="/assets/js/14.0a836303.js"><link rel="prefetch" href="/assets/js/15.c7a70042.js"><link rel="prefetch" href="/assets/js/16.eda894ef.js"><link rel="prefetch" href="/assets/js/17.9972567d.js"><link rel="prefetch" href="/assets/js/18.5c2087d9.js"><link rel="prefetch" href="/assets/js/19.9e5909ec.js"><link rel="prefetch" href="/assets/js/20.81cf4463.js"><link rel="prefetch" href="/assets/js/21.b1896877.js"><link rel="prefetch" href="/assets/js/22.3058e867.js"><link rel="prefetch" href="/assets/js/23.76b75888.js"><link rel="prefetch" href="/assets/js/24.cb2b6224.js"><link rel="prefetch" href="/assets/js/25.66f6d5cc.js"><link rel="prefetch" href="/assets/js/26.d3ba5339.js"><link rel="prefetch" href="/assets/js/27.1b1cd18a.js"><link rel="prefetch" href="/assets/js/28.d0ca9393.js"><link rel="prefetch" href="/assets/js/29.a10472bb.js"><link rel="prefetch" href="/assets/js/30.13388d66.js"><link rel="prefetch" href="/assets/js/32.097ed36d.js"><link rel="prefetch" href="/assets/js/33.e6ea0697.js"><link rel="prefetch" href="/assets/js/34.896ec5ef.js"><link rel="prefetch" href="/assets/js/35.9bd942f7.js"><link rel="prefetch" href="/assets/js/36.2b774afe.js"><link rel="prefetch" href="/assets/js/37.098262ce.js"><link rel="prefetch" href="/assets/js/38.6a5cbac5.js"><link rel="prefetch" href="/assets/js/39.03cc91d2.js"><link rel="prefetch" href="/assets/js/40.8d0a7377.js"><link rel="prefetch" href="/assets/js/41.dea6138e.js"><link rel="prefetch" href="/assets/js/42.555d373d.js"><link rel="prefetch" href="/assets/js/43.b47eb251.js"><link rel="prefetch" href="/assets/js/44.1ffd7b5b.js"><link rel="prefetch" href="/assets/js/45.cfb5da00.js"><link rel="prefetch" href="/assets/js/46.a56b9b85.js"><link rel="prefetch" href="/assets/js/47.4f781dff.js"><link rel="prefetch" href="/assets/js/48.4f542143.js"><link rel="prefetch" href="/assets/js/49.5c2eb801.js"><link rel="prefetch" href="/assets/js/5.e7fbaf2f.js"><link rel="prefetch" href="/assets/js/50.4fb88d7e.js"><link rel="prefetch" href="/assets/js/51.9028fef6.js"><link rel="prefetch" href="/assets/js/52.abb81def.js"><link rel="prefetch" href="/assets/js/6.896bf5be.js"><link rel="prefetch" href="/assets/js/7.b5260bec.js"><link rel="prefetch" href="/assets/js/8.5b3b73d8.js"><link rel="prefetch" href="/assets/js/9.eba5c3f6.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.2553b2f0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.75dd9f78.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container"><div><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/01.jpg" alt="Sumind's Blog" class="logo"> <span class="site-name">Sumind's Blog</span></a> <div class="links"><div class="color-picker"><a href="#" class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><!----> <div class="dark-theme-options toggle-option"><label for="dark-theme-toggle">是否开启夜览模式？</label> <input id="dark-theme-toggle" type="checkbox" checked="checked"></div></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      Blog
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/技术.html" class="nav-link"><i class="iconfont undefined"></i>
  技术
</a></li><li class="dropdown-item"><!----> <a href="/category/总结.html" class="nav-link"><i class="iconfont undefined"></i>
  总结
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  生活
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-other"></i>
      Blog
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/category/技术.html" class="nav-link"><i class="iconfont undefined"></i>
  技术
</a></li><li class="dropdown-item"><!----> <a href="/category/总结.html" class="nav-link"><i class="iconfont undefined"></i>
  总结
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  生活
</a></div><div class="nav-item"><a href="/timeLine/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript-Nodejs-08</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1-什么是路由" class="sidebar-link">1 什么是路由</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_2-为什么要拆分" class="sidebar-link">2 为什么要拆分</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_3-拆分路由一般规则" class="sidebar-link">3 拆分路由一般规则</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_4-使用路由语法" class="sidebar-link">4 使用路由语法</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1-1-已经学过的" class="sidebar-link">1.1 已经学过的</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1-2-关于安装第三方包的补充" class="sidebar-link">1.2 关于安装第三方包的补充</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1-3-切换-npm-镜像源" class="sidebar-link">1.3 切换 npm 镜像源</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1-4-package-json" class="sidebar-link">1.4 package.json</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1-5-一个神秘的文件夹-node-modules" class="sidebar-link">1.5 一个神秘的文件夹 node_modules</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1-6-require-的加载机制" class="sidebar-link">1.6 require 的加载机制</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_3-1-同源政策" class="sidebar-link">3.1 同源政策</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_3-2-什么是跨域请求" class="sidebar-link">3.2 什么是跨域请求</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_3-3-实现跨域请求的方案-jsonp" class="sidebar-link">3.3 实现跨域请求的方案--JSONP</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_1）jsonp简介" class="sidebar-link">1）JSONP简介</a></li><li class="sidebar-sub-header"><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_2）使用jsonp实现跨域请求" class="sidebar-link">2）使用JSONP实现跨域请求</a></li><li class="sidebar-sub-header"><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_3）实现跨域传输数据" class="sidebar-link">3）实现跨域传输数据</a></li><li class="sidebar-sub-header"><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_4）jquery封装的ajax方法跨域请求" class="sidebar-link">4）jQuery封装的ajax方法跨域请求</a></li></ul></li><li><a href="/views/category1/2017/JavaScript-Nodejs-08.html#_3-4-实现跨域请求的方案-cors" class="sidebar-link">3.4 实现跨域请求的方案--CORS</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <div><main class="page reco-hide"> <div class="page-title"><h1>JavaScript-Nodejs-08</h1> <hr> <div data-v-0b496ca7><i class="iconfont reco-account" data-v-0b496ca7><span data-v-0b496ca7>Sumind</span></i> <i class="iconfont reco-date" data-v-0b496ca7><span data-v-0b496ca7>2017-8-6</span></i> <!----> <!----></div></div> <div class="content__default"><h5 id="javascript-nodejs-08"><a href="#javascript-nodejs-08" aria-hidden="true" class="header-anchor">#</a> JavaScript-Nodejs-08</h5> <p>JavaScript-Nodejs</p> <h1 id="路由模块"><a href="#路由模块" aria-hidden="true" class="header-anchor">#</a> 路由模块</h1> <h2 id="_1-什么是路由"><a href="#_1-什么是路由" aria-hidden="true" class="header-anchor">#</a> 1 什么是路由</h2> <p>路由（router），就是请求的接口地址，比如 <code>/index.html</code> 、 <code>/add.html</code> 、 <code>/addStu</code> 、 <code>/login.html</code> 等</p> <h2 id="_2-为什么要拆分"><a href="#_2-为什么要拆分" aria-hidden="true" class="header-anchor">#</a> 2 为什么要拆分</h2> <p>完成学生管理案例之后，我们会发现app.js文件变的很大。</p> <p>越大的文件越难于维护，所以我们需要将app.js文件进行拆分，让每个文件变的更小，功能更单一，这样就有利于项目的后期维护了。</p> <p>原则： 让每个文件都更小，功能更单一</p> <h2 id="_3-拆分路由一般规则"><a href="#_3-拆分路由一般规则" aria-hidden="true" class="header-anchor">#</a> 3 拆分路由一般规则</h2> <p>==将功能相同或相近的功能单独拆分成一个路由文件==。</p> <p>比如学生管理案例</p> <p>可以将 和学生表相关的操作，比如 /index.html 、/add.html 、/addStu 接口放到 student.js 中保存；</p> <p>可以将和管理员表相关的操作, 比如 /login.html 、/checkUser 接口放到 login.js 中</p> <h2 id="_4-使用路由语法"><a href="#_4-使用路由语法" aria-hidden="true" class="header-anchor">#</a> 4 使用路由语法</h2> <p>在合适的位置创建 路由 文件，它也是一个js文件。比如将登陆和注册功能拆分成一个路由，则可以创建一个 login.js ，用于处理 /login.html 、/checkUser接口；比如再创建一个student.js，用于处理 /index.html 、/add.html 、 /addStu等接口。</p> <p>在login.js 中使用创建路由对象，将路由挂载到路由对象上</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 1. 加载express</span>
<span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 2. 创建路由对象</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 将接口挂载到路由对象上</span>
router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/checkLogin'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/login.html'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 4. 导出路由模块</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>然后在app.js 中加载路由，然后将其注册成中间件即可：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 5. 加载路由模块，并注册成中间件</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/login.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>拆分路由后，需要从新整理代码，解决错误。策略是路由文件中使用了什么第三方模块，就需要加载第三方模块，否则报错。</p></blockquote> <blockquote><p>按照上述拆分模块的原则，可以将添加留言和获取留言列表的路由也单独保存。</p></blockquote> <h1 id="npm相关"><a href="#npm相关" aria-hidden="true" class="header-anchor">#</a> npm相关</h1> <h2 id="_1-1-已经学过的"><a href="#_1-1-已经学过的" aria-hidden="true" class="header-anchor">#</a> 1.1 已经学过的</h2> <p>npm（node package manager）是node包管理器，我们之前学习过安装卸载包，**首次==本地==**安装，需要先初始化。</p> <p>初始化：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> init -y
<span class="token function">npm</span> init --yes
<span class="token function">npm</span> init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>全局安装：</p> <p>全局安装的一般都是命令，全局安装之后，在任何文件夹都可以使用这个命令。</p> <p>全局安装的东西，不能通过require加载。</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 安装命令</span>
<span class="token function">npm</span> i 包名 -g
<span class="token function">npm</span> <span class="token function">install</span> 包名 -g
<span class="token comment"># 卸载命令</span>
<span class="token function">npm</span> un 包名 -g
<span class="token function">npm</span> uninstall 包名 -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>本地安装：</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># 安装命令</span>
<span class="token function">npm</span> i 包名
<span class="token function">npm</span> <span class="token function">install</span> 包名
<span class="token comment"># 卸载命令</span>
<span class="token function">npm</span> un 包名
<span class="token function">npm</span> uninstall 包名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_1-2-关于安装第三方包的补充"><a href="#_1-2-关于安装第三方包的补充" aria-hidden="true" class="header-anchor">#</a> 1.2 关于安装第三方包的补充</h2> <ul><li><p>安装第三方包</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 老版本的node安装，后面加 --save,是为了把安装的第三方模块在package.json中做记录，新版不用</span>
<span class="token function">npm</span> <span class="token function">install</span> 包名 --save
<span class="token comment"># 正常的安装</span>
<span class="token function">npm</span> <span class="token function">install</span> 包名
<span class="token comment"># 一次安装多个包，名字之间用空格隔开</span>
<span class="token function">npm</span> <span class="token function">install</span> 包名1 包名2 包名3
<span class="token function">npm</span> i express mysql art-template
<span class="token comment"># 指定包的版本进行安装</span>
<span class="token function">npm</span> <span class="token function">install</span> 包名@版本号
<span class="token comment"># 简写</span>
<span class="token function">npm</span> i 包名
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>从缓存目录安装包</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看缓存目录</span>
<span class="token function">npm</span> config get cache
<span class="token comment"># 从缓存目录下载包</span>
<span class="token comment"># --cache-min 后面跟的是时间，单位是分钟，超过这个时间才去服务器下载</span>
<span class="token function">npm</span> <span class="token function">install</span> 包名 --cache-min 9999999
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>查看全局安装目录</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看全局安装时的安装目录</span>
<span class="token function">npm</span> root -g
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li></ul> <h2 id="_1-3-切换-npm-镜像源"><a href="#_1-3-切换-npm-镜像源" aria-hidden="true" class="header-anchor">#</a> 1.3 切换 npm 镜像源</h2> <ul><li><p>npm 存储包文件的服务器在国外，速度很慢，所以我们需要解决这个问题。</p></li> <li><p>国内淘宝的开发团队把 npm 在国内做了一个备份，网址是：http://npm.taobao.org/。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看当前的源</span>
<span class="token function">npm</span> config <span class="token function">ls</span>
<span class="token comment"># 在上面命令的结果有，有下面一行，该行记录的网站就是我们安装第三方模块的网站</span>
<span class="token comment"># registry = &quot;https://registry.npmjs.org/&quot;</span>

<span class="token comment"># 下载包的时候切换源</span>
<span class="token function">npm</span> <span class="token function">install</span> express --registry<span class="token operator">=</span>https://registry.npm.taobao.org
<span class="token comment"># 全局设置</span>
<span class="token function">npm</span> config <span class="token keyword">set</span> registry https://registry.npm.taobao.org
<span class="token comment"># 原始的路径</span>
<span class="token comment"># https://registry.npmjs.org/</span>
<span class="token comment"># nrm 是管理镜像源的模块，通过nrm来管理镜像源</span>
<span class="token function">npm</span> i nrm <span class="token comment"># 自行查询如何使用 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul> <h2 id="_1-4-package-json"><a href="#_1-4-package-json" aria-hidden="true" class="header-anchor">#</a> 1.4 package.json</h2> <p>在初始化之后，会生成一个package.json文件</p> <ul><li><p>创建 <code>package.json</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> init 
<span class="token function">npm</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>main</p> <p>main 字段指定了加载的入口文件</p></li> <li><p>dependencies  依赖(复数)</p> <ul><li>指定了当前项目所依赖（需要）的包</li> <li>软件的版本号 jQuery@3.3.1
<ol><li>大版本.次要版本.小版本</li> <li><strong>小版本</strong>：当项目在进行了局部修改或 bug 修正时，修正版本号加 1</li> <li><strong>次要版本</strong>：当项目在原有的基础上增加了部分功能时，主版本号不变，子版本号加 1</li> <li><strong>大版本</strong>：当项目在进行了重大修改或局部修正累积较多，而导致项目整体发生全局变化时，主版本号加 1</li></ol></li></ul> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token property">&quot;dependencies&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;art-template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.14.2&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;body-parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.18.3&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;express&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^4.16.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;express-art-template&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0.1&quot;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><code>dependencies</code> 字段指定了项目运行所依赖的模块</li> <li><strong>使用 <code>npm install</code> 可以安装所有的依赖</strong></li> <li>该对象的各个成员，分别由模块名和对应的版本要求组成，表示依赖的模块及其版本范围。
<ul><li><strong>指定版本</strong>：比如<code>1.2.2</code>，遵循“大版本.次要版本.小版本”的格式规定，安装时只安装指定版本。</li> <li><strong>波浪号（tilde）+指定版本</strong>：比如<code>~1.2.2</code>，表示安装1.2.x的最新版本（不低于1.2.2），但是不安装1.3.x，也就是说安装时不改变大版本号和次要版本号。</li> <li><strong>插入号（caret）+指定版本</strong>：比如ˆ1.2.2，表示安装1.x.x的最新版本（不低于1.2.2），但是不安装2.x.x</li></ul></li></ul></li> <li><p>scripts</p> <p><code>scripts</code>指定了运行脚本命令的 npm <strong>命令行</strong>缩写，比如start指定了运行<code>npm run start</code>时，所要执行的命令。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token string">&quot;scripts&quot;</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>,
    <span class="token string">&quot;start&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;node app.js&quot;</span>,
    <span class="token string">&quot;t&quot;</span><span class="token keyword">:</span> <span class="token string">&quot;dir c:\\&quot;</span>
 <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>运行 <code>scripts</code></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> run t
<span class="token function">npm</span> run start
<span class="token comment"># 只有 start 可以简化调用</span>
<span class="token function">npm</span> start

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul> <p>依赖的作用：</p> <ul><li>记录项目必须的包</li> <li>发送给别人的时候，不需要发送比较大的 <code>node_modules</code> 文件夹。只需要发送给你 <code>package.json</code> 即可，你只需要执行 <code>npm install</code> 即可安装所有的包</li></ul> <h2 id="_1-5-一个神秘的文件夹-node-modules"><a href="#_1-5-一个神秘的文件夹-node-modules" aria-hidden="true" class="header-anchor">#</a> 1.5 一个神秘的文件夹 node_modules</h2> <ul><li><p>我们下载第三方包的时候，会自动把下载的第三方包，放到 <code>node_modules</code> 中。使用第三方包的时候直接 <code>require('第三方包的名字')</code>。</p></li> <li><p>我们自己写的包也可以放到此文件夹，<strong>加载的时候直接写包名</strong>即可。</p></li> <li><p><code>require</code>  的加载顺序</p> <ul><li><p>打印 module 对象</p></li> <li><p>包加载的过程，按照 <code>module.paths</code> 中的路径一级一级往上查找</p></li> <li><p>第一次 <code>require()</code> 加载完毕，会把 模块/包 <strong>缓存</strong>起来，再次 <code>require()</code> 的时候直接从缓存加载</p></li></ul></li></ul> <h2 id="_1-6-require-的加载机制"><a href="#_1-6-require-的加载机制" aria-hidden="true" class="header-anchor">#</a> 1.6 require 的加载机制</h2> <ul><li><code>require</code> 优先加载<strong>缓存</strong>中的模块</li> <li>如果缓存中没有模块，优先加载<strong>核心模块（node自带的模块）</strong>，并缓存</li> <li>如果有<strong>相对路径</strong>，则根据路径加载<strong>文件模块</strong>，并缓存
<ul><li><code>require('./main')</code>  省略扩展名的情况</li> <li>先加载 <code>main.js</code>，如果没有再加载 <code>main.json</code>，如果没有再加载 <code>main.node</code>(c/c++编写的模块)</li></ul></li> <li>如果不是文件模块，也不是核心模块，则加载<strong>第三方模块</strong></li> <li>node 会去 node_modules 目录中找（找跟你引用的名称一样的目录），例如这里 <code>require('moment')</code></li> <li>如果在 node_modules 目录中找到 <code>moment</code> 目录，则加载该模块并缓存</li> <li>如果过程都找不到，node 则取上一级目录下找 <code>node_modules</code> 目录，规则同上</li> <li>如果一直找到代码文件的根路径还找不到，则报错</li></ul> <h1 id="_2-es6降级处理"><a href="#_2-es6降级处理" aria-hidden="true" class="header-anchor">#</a> 2. ES6降级处理</h1> <p>因为 ES 6 有浏览器兼容性问题，可以使用一些工具进行降级处理，例如：<strong>babel</strong></p> <ul><li><p>降级处理 babel 的使用步骤</p> <ol><li>安装 Node.js</li> <li>命令行中安装 babel</li> <li>配置文件 <code>.babelrc</code></li> <li>运行</li></ol></li> <li><p>项目初始化(项目文件夹不能有中文)</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>在命令行中，安装 babel <a href="https://babeljs.io" target="_blank" rel="noopener noreferrer">babel官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span>  @babel/core @babel/cli @babel/preset-env
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>配置文件 <code>.babelrc</code> (手工创建这个文件)</p> <p>babel 的降级处理配置</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>在命令行中，运行</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 把转换的结果输出到指定的文件</span>
npx babel index.js -o test.js
<span class="token comment"># 把转换的结果输出到指定的目录</span>
npx babel 包含有js的原目录 -d 转换后的新目录
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <h1 id="_3-ajax跨域请求"><a href="#_3-ajax跨域请求" aria-hidden="true" class="header-anchor">#</a> 3. Ajax跨域请求</h1> <h2 id="_3-1-同源政策"><a href="#_3-1-同源政策" aria-hidden="true" class="header-anchor">#</a> 3.1 同源政策</h2> <p>1995年，同源政策由 Netscape（网景） 公司引入浏览器。目前，所有浏览器都实行这个政策。</p> <p>最初，它的含义是指，A 网站设置的 Cookie，B 网站不能打开，除非这两个网页同源。所谓同源指的是三个相同。</p> <ul><li>协议相同（http https）</li> <li>域名相同</li> <li>端口相同（http默认80端口，https默认443端口）</li></ul> <p>随着互联网的发展，同源政策越来越严格。目前，如果非同源，共有三种行为受到限制。</p> <ul><li>Cookie无法读取。</li> <li>DOM 无法获得。</li> <li>AJAX 请求无效（可以发送，但浏览器会拒绝接受响应）。</li></ul> <h2 id="_3-2-什么是跨域请求"><a href="#_3-2-什么是跨域请求" aria-hidden="true" class="header-anchor">#</a> 3.2 什么是跨域请求</h2> <p>其实，了解了什么是同源政策，就知道什么是跨域请求了。</p> <p>在发送Ajax请求的时候，请求的地址只要违反了同源政策，那么就属于跨域请求。</p> <h2 id="_3-3-实现跨域请求的方案-jsonp"><a href="#_3-3-实现跨域请求的方案-jsonp" aria-hidden="true" class="header-anchor">#</a> 3.3 实现跨域请求的方案--JSONP</h2> <h3 id="_1）jsonp简介"><a href="#_1）jsonp简介" aria-hidden="true" class="header-anchor">#</a> 1）JSONP简介</h3> <p><strong>JSON</strong> with <strong>P</strong>adding，是一种借助于 <code>script</code> 标签发送跨域请求的技巧。</p> <p>其原理就是在客户端借助 <code>script</code> 标签请求服务端的一个地址，服务端的这个地址返回一段带有调用某个全局函数调用的 JavaScript 脚本（而非一段 HTML），将原本需要返回给客户端的数据通过参数传递给这个函数，函数中就可以得到原本服务端想要返回的数据。</p> <p>以后绝大多数情况都是采用 JSONP 的手段完成不同源地址之间的跨域请求</p> <h3 id="_2）使用jsonp实现跨域请求"><a href="#_2）使用jsonp实现跨域请求" aria-hidden="true" class="header-anchor">#</a> 2）使用JSONP实现跨域请求</h3> <ol><li><p>首先得创建两个服务器，一个服务器（:3000)向另外一个服务器(:4000)发送请求</p></li> <li><p>在3000里面写一个HTML页面jsonp2.html</p></li> <li><p>在3000里面，3000.js中，返回jsonp2.html</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/j2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">sendFile</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">'/jsonp2.html'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>重启服务器，此时，访问127.0.0.1:3000/j2就可以看到页面</p></li> <li><p>在3000中的 jsonp2.html 中，通过script的src属性，请求4000网站中的一个接口</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://127.0.0.1:4000/jsonp2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>到4000中，写接口 jsonp2，完成响应</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/jsonp2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回的内容，只要符合JS的语法即可</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'var aa = &quot;hello&quot;;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>写好之后，4000要重启服务器</p></li> <li><p>在3000中的jsonp2.html中就可以使用4000网站返回的aa变量了</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://127.0.0.1:4000/jsonp2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 输出4000网站返回的内容</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>aa<span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h3 id="_3）实现跨域传输数据"><a href="#_3）实现跨域传输数据" aria-hidden="true" class="header-anchor">#</a> 3）实现跨域传输数据</h3> <p>前面实现了跨域请求，4000网站返回一个字符串，3000网站接收到之后，就会执行这个字符串，所以会得到变量aa。</p> <p>如果4000网站返回一个调用函数的字符串，那么3000网站接收到之后，也会执行一个函数。然后给函数传递一个参数，这个参数就是要传输的数据。</p> <ol><li><p>4000网站，返回一个调用函数的字符串</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/jsonp2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回的内容，只要符合JS的语法即可</span>
    <span class="token comment">// res.end('var aa = &quot;hello&quot;;');</span>
    <span class="token comment">// 要把一个JS数组返回给3000网站</span>
    <span class="token comment">// res.end('abc();');</span>
    <span class="token comment">// 告诉3000网站调用abc函数，并且传递给abc函数数据</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">'abc([&quot;apple&quot;, &quot;banana&quot;]);'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>3000网站，要提前准备好一个叫做abc的函数，用于接收4000返回的数据</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 输出4000网站返回的内容</span>
    <span class="token comment">// console.log(aa);</span>

    <span class="token comment">// 为了配合4000网站的要求，所以要定义一个abc函数</span>
    <span class="token keyword">function</span> <span class="token function">abc</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://127.0.0.1:4000/jsonp2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这样就可以实现跨域请求了。并且也实现了数据的传输。</p> <p>问题是两个网站的函数名字如何统一？大家有一个约定，请求的时候，要把你的函数名传递给4000网站，并且参数名必须是callback。</p></li> <li><p>3000网站中，将函数名以参数的形式，传递过去</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token comment">// 输出4000网站返回的内容</span>
    <span class="token comment">// console.log(aa);</span>

    <span class="token comment">// 为了配合4000网站的要求，所以要定义一个abc函数</span>
    <span class="token keyword">function</span> <span class="token function">abc</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://127.0.0.1:4000/jsonp2?callback=abc<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>4000网站中，获取地址栏的callback参数，值就是函数的名字</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/jsonp2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回的内容，只要符合JS的语法即可</span>
    <span class="token comment">// res.end('var aa = &quot;hello&quot;;');</span>
    <span class="token comment">// 要把一个JS数组返回给3000网站</span>
    <span class="token comment">// res.end('abc();');</span>
    <span class="token comment">// res.end('abc([&quot;apple&quot;, &quot;banana&quot;]);');</span>
    <span class="token comment">// 获取url中的参数callback，参数的值就是函数的名字</span>
    <span class="token comment">// 下面一行是url模块的老版本用法</span>
    <span class="token comment">// console.log(url.parse(req.url));</span>
    <span class="token comment">// 下面一行是url模块的新版用法，要求传递一个完整的url，所以瞎写了一个域名，目的就是为了补全url</span>
    <span class="token comment">// console.log(new URL(req.url, 'http://www.xx.com').searchParams.get('callback')); // abc</span>
    <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token string">'http://www.xx.com'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'callback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// abc</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>fn <span class="token operator">+</span> <span class="token string">'([&quot;apple&quot;, &quot;banana&quot;])'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li></ol> <h3 id="_4）jquery封装的ajax方法跨域请求"><a href="#_4）jquery封装的ajax方法跨域请求" aria-hidden="true" class="header-anchor">#</a> 4）jQuery封装的ajax方法跨域请求</h3> <ol><li><p>在3000网站中，jsonp2.html 中引入一个jQuery文件，为了方便（引入自己的jQuery，自己就得写处理静态资源文件的代码），引入的是百度提供的jquery</p></li> <li><p>使用jQuery提供的ajax方法，实现跨域访问</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- 使用jQuery提供的ajax方法，实现跨域请求 --&gt;</span>
<span class="token comment">&lt;!-- 下面引入百度提供的jQuery，需要联网 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://libs.baidu.com/jquery/2.1.4/jquery.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">,</span>
        <span class="token comment">// data: {}, // 发送给4000网站的数据</span>
        url<span class="token punctuation">:</span> <span class="token string">'http://127.0.0.1:4000/jsonp3?callback=?'</span><span class="token punctuation">,</span> <span class="token comment">// ? 可以理解为下面的success方法。</span>
        <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// result就是4000服务器返回的数据</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        dataType<span class="token punctuation">:</span> <span class="token string">'jsonp'</span> <span class="token comment">// 必须要指定dataType为jsonp</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li> <li><p>被请求的4000网站中，设置一个 jsonp3 接口，接口的内容和 jsonp2 接口一样。也是获取地址栏的callback参数，并返回调用这个函数的字符串</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/jsonp3'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取地址栏的callback参数，值是3000中的一个函数名</span>
    <span class="token keyword">let</span> fn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token string">'http://www.xx.com'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>searchParams<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'callback'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 返回一个调用函数的字符串</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>fn <span class="token operator">+</span> <span class="token string">'([&quot;red&quot;, &quot;yellow&quot;])'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h2 id="_3-4-实现跨域请求的方案-cors"><a href="#_3-4-实现跨域请求的方案-cors" aria-hidden="true" class="header-anchor">#</a> 3.4 实现跨域请求的方案--CORS</h2> <p>通过在**==被==请求的路由中**设置header头，可以实现跨域。不过这种方式只有最新的浏览器（IE10）才支持。</p> <p>Cross Origin Resource Share，跨域资源共享</p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/time'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// // 允许任意源访问，不安全</span>
  <span class="token comment">// res.setHeader('Access-Control-Allow-Origin', '*')</span>
  <span class="token comment">// 允许指定源访问</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">'Access-Control-Allow-Origin'</span><span class="token punctuation">,</span> <span class="token string">'http://www.xxx.com'</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这种方案无需客户端作出任何变化（客户端不用改代码），只是在被请求的服务端响应的时候添加一个 <code>Access-Control-Allow-Origin</code> 的响应头，表示这个资源是否允许指定域请求。</p></div> <!----> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/18/2019, 2:26:44 AM</span></div></footer> <!----> </main> <div class="valine-wrapper" data-v-0162251c><div id="valine" data-v-0162251c></div></div></div> <div class="back-to-ceiling" style="right:1rem;bottom:3rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-d0bfeaa4 data-v-d0bfeaa4><i class="iconfont reco-up" data-v-d0bfeaa4></i></div></div></div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.a9f6d8ec.js" defer></script><script src="/assets/js/4.f605a52d.js" defer></script><script src="/assets/js/1.a2510d10.js" defer></script><script src="/assets/js/31.cd6ba917.js" defer></script>
  </body>
</html>
